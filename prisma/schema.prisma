// schema.prisma - Updated for Multi-Team Architecture

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Team {
  id          String   @id @default(cuid())
  guildId     String   // Discord server ID
  name        String   // Team name (e.g., "Valorant Team", "League Team")
  roleId      String   @unique // Discord role ID for this team
  tier        String   @default("free")
  createdBy   String   // Discord user ID who created the team
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  players     Player[]
  events      Event[]
  
  @@unique([guildId, roleId]) // Each role can only have one team per server
  @@index([guildId])
  @@index([roleId])
}

model Player {
  id        String   @id @default(cuid())
  discordId String   // Discord user ID
  username  String
  teamId    String
  addedBy   String?  // Who manually added this player (if not auto-added by role)
  createdAt DateTime @default(now())
  
  team      Team       @relation(fields: [teamId], references: [id], onDelete: Cascade)
  responses Response[]
  
  @@unique([discordId, teamId]) // User can be in multiple teams
  @@index([teamId])
  @@index([discordId])
}

model Event {
  id          String   @id @default(cuid())
  teamId      String   // Which team this event belongs to
  name        String
  date        String
  time        String
  gameType    String?
  notes       String?
  createdBy   String   // Discord user ID
  messageId   String?  // Discord message ID
  channelId   String?  // Discord channel ID
  createdAt   DateTime @default(now())
  
  team      Team       @relation(fields: [teamId], references: [id], onDelete: Cascade)
  responses Response[]
  
  @@index([teamId])
  @@index([createdAt])
}

model Response {
  id        String   @id @default(cuid())
  playerId  String
  eventId   String
  status    String   // "available", "unavailable", "maybe"
  timestamp DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)
  event  Event  @relation(fields: [eventId], references: [id], onDelete: Cascade)
  
  @@unique([playerId, eventId])
  @@index([eventId])
  @@index([playerId])
}
